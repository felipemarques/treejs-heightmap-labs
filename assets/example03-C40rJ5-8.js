import{G as se,l as f,d as u,M as d,W as Ae,S as Be,C as Oe,a as Ie,O as Ne,b as _e,H as Fe,D as Ue,V as C,j as Ke,m as Ve,h as We,e as Te}from"./PointerLockControls-CkVu5uzN.js";import{S as Ze,c as Xe}from"./simplex-noise-BLd_4JM9.js";import{a as Ye}from"./alea-wHZKoMPZ.js";function Je(e={}){const{skinColor:t=7049074,shirtColor:n=4019566,pantsColor:o=1909811,trimColor:s=9741240,accessoryColor:r=8011565,scale:i=1,speedFactor:c=1.5}=e,a=new se;a.name="ZombieNPC";const w=new f(1.6,2.2,1),g=new u({color:n,flatShading:!0}),I=new d(w,g);I.position.y=2.1,a.add(I);const pe=new f(1.2,1.2,1.2),q=new u({color:t,flatShading:!0}),N=new d(pe,q);N.position.y=3.5,a.add(N);const me=new f(1.2,.35,1.1),_=new d(me,q);_.position.set(0,2.95,.02),a.add(_);const we=new f(1.2,.25,1.2),he=new u({color:2764605,flatShading:!0}),Q=new d(we,he);Q.position.set(0,4.15,0),a.add(Q);const ge=new f(.9,.35,.6),xe=new u({color:1707794,flatShading:!0}),ee=new d(ge,xe);ee.position.set(0,3.05,.65),a.add(ee);const F=new se,ye=new f(.12,.16,.2),be=new u({color:14936043,flatShading:!0});for(let R=-2;R<=2;R++){const M=new d(ye,be);M.position.set(R*.18,0,.35),F.add(M)}F.position.set(0,3,.65),a.add(F);const ve=new f(.45,1.8,.6),Se=new u({color:n,flatShading:!0}),G=new d(ve,Se);G.position.set(-1.1,2.1,0);const U=G.clone();U.position.x=1.1,a.add(G,U);const Me=new f(.55,.45,.6),Le=new u({color:t,flatShading:!0}),D=new d(Me,Le);D.position.set(-1.1,1.25,0);const K=D.clone();K.position.x=1.1,a.add(D,K);const Ee=new f(.55,1.8,.7),Ce=new u({color:o,flatShading:!0}),P=new d(Ee,Ce);P.position.set(-.5,.9,0);const V=P.clone();V.position.x=.5,a.add(P,V);const ke=new f(.7,.35,1),Ge=new u({color:s,flatShading:!0}),j=new d(ke,Ge);j.position.set(-.5,.15,.1);const W=j.clone();W.position.x=.5,a.add(j,W);const De=new f(1.7,.18,1.05),Pe=new u({color:r,flatShading:!0}),te=new d(De,Pe);te.position.set(0,1.6,0),a.add(te);const je=new f(1.9,.25,1.05),oe=new d(je,g);oe.position.set(0,3.1,0),a.add(oe);const Re=new f(.2,.2,.1),ze=new u({color:1052688,flatShading:!0}),T=new d(Re,ze),ne=T.clone();T.position.set(-.3,3.65,.65),ne.position.set(.3,3.65,.65),a.add(T,ne),a.scale.setScalar(i);const l={swaySpeed:2,stepSpeed:2.3*c,headBob:0,armL:G,armR:U,legL:P,legR:V,handL:D,handR:K,footL:j,footR:W,jaw:_};function He(R,M){const $e=Math.sin(M*l.swaySpeed)*.25,b=Math.sin(M*l.stepSpeed)*.35;l.armL.rotation.x=b*1.3,l.armR.rotation.x=-b*1.3,l.legL.rotation.x=-b,l.legR.rotation.x=b,l.handL.rotation.x=b*1.1,l.handR.rotation.x=-b*1.1,l.footL.rotation.x=-b*.8,l.footR.rotation.x=b*.8,l.headBob=.07*Math.sin(M*3.2*c),N.position.y=3.5+l.headBob,l.jaw.rotation.x=Math.max(0,Math.sin(M*3.4*c)*.16),I.rotation.y=$e*.2,a.rotation.y+=0}return{object:a,update:He}}const qe=document.getElementById("c"),y=new Ae({canvas:qe,antialias:!0});y.setPixelRatio(window.devicePixelRatio);y.setSize(window.innerWidth,window.innerHeight);const S=new Be;S.background=new Oe(790295);const v=new Ie(60,window.innerWidth/window.innerHeight,.1,3e3);v.position.set(20,20,20);const L=new Ne(v,y.domElement);L.enableDamping=!0;L.target.set(0,12,0);const p=new _e(v,y.domElement);p.getObject().position.set(0,12,20);S.add(p.getObject());S.add(new Fe(10533375,1054752,.75));const ie=new Ue(16777215,.9);ie.position.set(300,500,200);S.add(ie);const m=25,ce=[{segments:32,distance:m*.75},{segments:16,distance:m*1.5},{segments:8,distance:m*3},{segments:4,distance:m*5}],de=40,z=2,Qe=5,et=document.getElementById("hud"),x=new Ze;x.showPanel(0);x.dom.style.position="absolute";x.dom.style.top="12px";x.dom.style.left="calc(50% - 40px)";document.body.appendChild(x.dom);const H=Xe(Ye("heightmap-seed-03")),E=new Map,Z=new Map,tt=new Ke,ot=gt(y.getContext()),nt=navigator.hardwareConcurrency||"n/d",Y=[];function O(e,t){const n=e/180,o=t/180;return(1*H(n,o)+.6*H(n*2.2,o*2.2)+.35*H(n*4.4,o*4.4)+.18*H(n*7.5,o*7.5)+1)/2*de}function st(e){const t=Math.max(0,Math.min(1,e/de));return t<.35?$([28,74,122],[47,141,255],t/.35):t<.55?$([45,106,63],[84,168,99],(t-.35)/.2):t<.8?$([115,104,87],[177,163,131],(t-.55)/.25):$([232,235,240],[255,255,255],(t-.8)/.2)}function $(e,t,n){const o=Math.max(0,Math.min(1,n));return{r:(e[0]+(t[0]-e[0])*o)/255,g:(e[1]+(t[1]-e[1])*o)/255,b:(e[2]+(t[2]-e[2])*o)/255}}function le(e,t){return`${e},${t}`}function at(e){if(Z.has(e))return Z.get(e);const t=new u({vertexColors:!0,flatShading:!1,roughness:.85,metalness:0});return Z.set(e,t),t}function rt(e,t,n){const o=new We(m,m,e,e);o.rotateX(-Math.PI/2);const s=o.attributes.position,r=new Float32Array(s.count*3);for(let i=0;i<s.count;i++){const c=s.getX(i)+t,a=s.getZ(i)+n,w=O(c,a);s.setY(i,w);const g=st(w);r[i*3+0]=g.r,r[i*3+1]=g.g,r[i*3+2]=g.b}return o.setAttribute("color",new Te(r,3)),o.computeVertexNormals(),o}function it(e,t){const n=le(e,t);if(E.has(n))return E.get(n);const o=e*m+m/2,s=t*m+m/2,r=new Ve;for(const c of ce){const a=rt(c.segments,o,s),w=new d(a,at("terrain"));w.position.set(o,0,s),r.addLevel(w,c.distance)}S.add(r);const i={lod:r,ix:e,iz:t,lastUsed:performance.now()};return E.set(n,i),i}function ct(e){!e||!e.lod||(e.lod.levels.forEach(({object:t})=>{t.geometry&&t.geometry.dispose()}),S.remove(e.lod))}function fe(){const e=Math.floor(v.position.x/m),t=Math.floor(v.position.z/m),n=new Set;for(let o=-z;o<=z;o++)for(let s=-z;s<=z;s++){const r=e+s,i=t+o;n.add(le(r,i)),it(r,i).lastUsed=performance.now()}for(const[o,s]of E.entries())n.has(o)||(ct(s),E.delete(o))}function dt(){const e=y.info,t=e.render.triangles,n=Math.round(x.getFPS?x.getFPS():0)||"--",o=performance.memory?`${(performance.memory.usedJSHeapSize/1048576).toFixed(1)} / ${(performance.memory.jsHeapSizeLimit/1048576).toFixed(0)} MB`:"n/d";et.innerHTML=`
        <div>Chunks carregados: ${E.size}</div>
        <div>LOD levels: ${ce.length}</div>
        <div>Draws: ${e.render.calls} | Tris: ${t.toLocaleString("pt-BR")}</div>
        <div>Geom/Tex: ${e.memory.geometries} / ${e.memory.textures}</div>
        <div>GPU: ${ot}</div>
        <div>CPU cores: ${nt}</div>
        <div>Heap: ${o}</div>
        <div>Altura do pulo: ${B.toFixed(2)} m</div>
        <div>Altura m√°x. registrada: ${J.toFixed(2)} m</div>
        <div>FPS: ${n}</div>
      `}const h={forward:!1,backward:!1,left:!1,right:!1,jump:!1};let A=!1,k=0,B=0,J=0;const ae=new C;function lt(){const e=document.getElementById("info");y.domElement.addEventListener("click",n=>{n.preventDefault(),p.lock()}),p.addEventListener("lock",()=>{e.style.opacity="0.75",L.enabled=!1}),p.addEventListener("unlock",()=>{e.style.opacity="1",L.enabled=!0,L.target.copy(p.getObject().position),L.update()})}function ft(){const e=t=>n=>{switch(n.code){case"KeyW":case"ArrowUp":h.forward=t;break;case"KeyS":case"ArrowDown":h.backward=t;break;case"KeyA":case"ArrowLeft":h.left=t;break;case"KeyD":case"ArrowRight":h.right=t;break;case"Space":h.jump=t;break}};document.addEventListener("keydown",e(!0)),document.addEventListener("keyup",e(!1))}const ut=new C,X=new C,re=new C;function pt(e){if(!p.isLocked)return;const t=(h.right?1:0)-(h.left?1:0),n=(h.forward?1:0)-(h.backward?1:0),o=t!==0||n!==0,s=18;if(o){X.copy(p.getDirection(ut)).setY(0).normalize(),re.crossVectors(X,new C(0,1,0)).normalize();const g=p.getObject().position;g.addScaledVector(X,n*s*e),g.addScaledVector(re,t*s*e)}const r=35,i=18;k-=r*e;const c=p.getObject().position,w=O(c.x,c.z)+Qe;h.jump&&A&&(k=i,A=!1),c.y+k*e<=w?(c.y=w,k=0,A=!0):(c.y+=k*e,A=!1),B=Math.max(0,c.y-w),B>J&&(J=B)}function mt(e,t){if(Y.length===0)return;const n=p.getObject().position;Y.forEach(o=>{o.update(e,t),ae.copy(n);const s=o.object.position,r=ae.clone().sub(s);r.y=0,r.length()>1.5&&(r.normalize(),s.addScaledVector(r,7.5*e),o.object.rotation.y=Math.atan2(r.x,r.z)),s.y=O(s.x,s.z)+.1})}function ue(){const e=tt.getDelta();x.begin(),requestAnimationFrame(ue),pt(e),mt(e,performance.now()*.001),fe(),p.isLocked||L.update(),y.render(S,v),x.end(),dt()}function wt(){const{innerWidth:e,innerHeight:t}=window;v.aspect=e/t,v.updateProjectionMatrix(),y.setSize(e,t)}window.addEventListener("resize",wt);fe();lt();ft();ht();ue();function ht(){const e=new C(10,0,10),t=Je({scale:1.05,speedFactor:2.5});t.object.position.copy(e),t.object.position.y=O(e.x,e.z)+.1,S.add(t.object),Y.push(t)}function gt(e){const t=e.getExtension("WEBGL_debug_renderer_info");if(t){const n=e.getParameter(t.UNMASKED_VENDOR_WEBGL),o=e.getParameter(t.UNMASKED_RENDERER_WEBGL);return`${n} | ${o}`}return"n/d"}
