import{W as V,S as _,C as O,a as q,O as T,b as Y,A as J,D as X,h as Q,d as Z,M as ee,V as S,j as te,k as y,e as ne}from"./PointerLockControls-CkVu5uzN.js";import{S as oe,c as re}from"./simplex-noise-BLd_4JM9.js";const se=document.getElementById("c"),x=new V({canvas:se,antialias:!0});x.setPixelRatio(window.devicePixelRatio);x.setSize(window.innerWidth,window.innerHeight);const C=new _;C.background=new O(987414);const l=new q(60,window.innerWidth/window.innerHeight,.1,1e3);l.position.set(80,45,80);const g=256,H=256,p=200,R=40,u=new T(l,x.domElement);u.enableDamping=!0;u.target.set(0,10,0);const z=new Y(l,x.domElement);l.position.set(0,R+10,40);u.target.copy(l.position);C.add(new J(16777215,.35));const I=new X(16777215,.9);I.position.set(80,120,40);C.add(I);const{data:L}=he(g,H),j=new Q(p,p,g-1,H-1);j.rotateX(-Math.PI/2);ve(j,L,R);const ae=new Z({vertexColors:!0,flatShading:!1,roughness:.9,metalness:0}),N=new ee(j,ae);N.receiveShadow=!1;C.add(N);window.addEventListener("resize",pe);const r=new oe;r.showPanel(0);r.dom.style.position="absolute";r.dom.style.top="12px";r.dom.style.left="calc(50% - 40px)";document.body.appendChild(r.dom);const ie=document.getElementById("perf"),ce=x.getContext(),de=Se(ce),le=new te,d={forward:!1,backward:!1,left:!1,right:!1,jump:!1},M=new S,A=new S,W=new S,B=new S,fe=new S,me=new S(0,1,0);let $=!1;const k={moveSpeed:35,jumpSpeed:12,gravity:35,eyeHeight:6};xe();we();K();function K(){const e=le.getDelta();r.begin(),requestAnimationFrame(K),ye(e),u.enabled&&u.update(),x.render(C,l),r.end(),ue()}function pe(){const{innerWidth:e,innerHeight:t}=window;l.aspect=e/t,l.updateProjectionMatrix(),x.setSize(e,t)}function ue(){const e=x.info,t=Math.round(r.getFPS?r.getFPS():1e3/r.dom.children[0].innerText||0),o=Math.round(r.dom.firstChild&&r.dom.firstChild.textContent?parseFloat(r.dom.firstChild.textContent):r.dom?r.dom.textContent:0),n=performance.memory?`${(performance.memory.usedJSHeapSize/1048576).toFixed(1)} / ${(performance.memory.jsHeapSizeLimit/1048576).toFixed(0)} MB`:"n/d";ie.innerHTML=`
        <div>FPS: ${t||"--"}</div>
        <div>ms: ${Number.isFinite(o)?o:"--"}</div>
        <div>Draws: ${e.render.calls} | Tris: ${e.render.triangles}</div>
        <div>Geom/Mats: ${e.memory.geometries} / ${e.memory.textures}</div>
        <div>GPU: ${de}</div>
        <div>Mem: ${n}</div>
      `}function xe(){const e=document.getElementById("info");x.domElement.addEventListener("click",t=>{t.preventDefault(),z.lock()}),z.addEventListener("lock",()=>{e.style.opacity="0.75",u.enabled=!1}),z.addEventListener("unlock",()=>{e.style.opacity="1",u.enabled=!0,u.target.copy(l.position),u.update()})}function we(){const e=t=>o=>{switch(o.code){case"KeyW":case"ArrowUp":d.forward=t;break;case"KeyS":case"ArrowDown":d.backward=t;break;case"KeyA":case"ArrowLeft":d.left=t;break;case"KeyD":case"ArrowRight":d.right=t;break;case"Space":d.jump=t;break}};document.addEventListener("keydown",e(!0)),document.addEventListener("keyup",e(!1))}function ge(e,t){const o=p/2,n=y.clamp((e+o)/p,0,1),w=y.clamp((t+o)/p,0,1),c=n*(g-1),s=w*(H-1),f=Math.floor(c),a=Math.floor(s),m=Math.min(f+1,g-1),h=Math.min(a+1,H-1),i=c-f,v=s-a,P=a*g+f,E=a*g+m,b=h*g+f,G=h*g+m,D=y.lerp(L[P],L[E],i),U=y.lerp(L[b],L[G],i);return y.lerp(D,U,v)*R}function ye(e){if(!z.isLocked)return;A.set((d.right?1:0)-(d.left?1:0),0,(d.forward?1:0)-(d.backward?1:0)).normalize();const t=l.position;A.lengthSq()>0&&(W.copy(z.getDirection(fe)).setY(0).normalize(),B.crossVectors(W,me).normalize(),t.addScaledVector(W,A.z*k.moveSpeed*e),t.addScaledVector(B,A.x*k.moveSpeed*e)),M.y-=k.gravity*e;const n=ge(t.x,t.z)+k.eyeHeight;d.jump&&$&&(M.y=k.jumpSpeed,$=!1),t.y+M.y*e<=n?(t.y=n,M.y=0,$=!0):(t.y+=M.y*e,$=!1),t.x=y.clamp(t.x,-p/2+1,p/2-1),t.z=y.clamp(t.z,-p/2+1,p/2-1)}function he(e,t){const o=re(),n=new Float32Array(e*t),w=4,c=2,s=.5,f=.02;let a=1/0,m=-1/0;for(let i=0;i<t;i++)for(let v=0;v<e;v++){let P=1,E=f,b=0;for(let D=0;D<w;D++)b+=P*o(v*E,i*E),P*=s,E*=c;const G=i*e+v;n[G]=b,a=Math.min(a,b),m=Math.max(m,b)}const h=m-a||1;for(let i=0;i<n.length;i++)n[i]=(n[i]-a)/h;return{data:n,min:a,max:m}}function ve(e,t,o){const n=e.attributes.position,w=n.count,c=new Float32Array(w*3);for(let s=0;s<w;s++){const f=t[s];n.setY(s,f*o);const{r:a,g:m,b:h}=be(f);c[s*3+0]=a,c[s*3+1]=m,c[s*3+2]=h}e.setAttribute("color",new ne(c,3)),n.needsUpdate=!0,e.computeVertexNormals()}function be(e){return e<.35?F([31,79,131],[43,115,182],e/.35):e<.55?F([44,110,73],[79,162,91],(e-.35)/.2):e<.75?F([115,104,87],[179,156,122],(e-.55)/.2):F([229,231,235],[255,255,255],(e-.75)/.25)}function F(e,t,o){const n=Math.max(0,Math.min(1,o)),w=e[0]+(t[0]-e[0])*n,c=e[1]+(t[1]-e[1])*n,s=e[2]+(t[2]-e[2])*n;return{r:w/255,g:c/255,b:s/255}}function Se(e){const t=e.getExtension("WEBGL_debug_renderer_info");if(t){const o=e.getParameter(t.UNMASKED_VENDOR_WEBGL),n=e.getParameter(t.UNMASKED_RENDERER_WEBGL);return`${o} | ${n}`}return"n/d"}
