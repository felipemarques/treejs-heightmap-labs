import{G as E,l as r,d as a,M as s,p as no,V as A,q as N,W as fo,S as uo,C as ho,a as po,O as go,b as mo,H as yo,D as xo,j as bo,m as So,h as Mo,e as vo,k as R}from"./PointerLockControls-CkVu5uzN.js";import{S as Do,c as Po}from"./simplex-noise-BLd_4JM9.js";import{a as K}from"./alea-wHZKoMPZ.js";function Eo(){const o=new E,t=new r(10,6,10),e=new a({color:8026746,roughness:.9,flatShading:!0}),n=new s(t,e);n.position.y=3,o.add(n);const l=new r(10,8,10),i=new a({color:12951912,roughness:.7,flatShading:!0}),d=new s(l,i);d.position.y=7+.5,o.add(d);const c=new a({color:4861466,roughness:.8,flatShading:!0}),w=new E,f=new r(10.2,.4,.4),y=new r(.4,8.4,.4);[4.5,0,-4.5].forEach(b=>{const h=new s(f,c);h.position.set(0,7,b),w.add(h)}),[-4.8,4.8].forEach(b=>{const h=new s(y,c);h.position.set(b,7,-4.8),w.add(h);const M=h.clone();M.position.z=4.8,w.add(M)}),w.position.y=.5,o.add(w);const u=new r(12,1.2,12),m=new a({color:9059103,roughness:.8,flatShading:!0}),x=new s(u,m);x.position.y=11+1.2,x.scale.y=1.4,x.rotation.x=.08,o.add(x);const v=new s(new r(1,3,1),new a({color:5921370,flatShading:!0}));v.position.set(-3,x.position.y+1.5,2),o.add(v);const p=new r(1.2,1.2,.2),g=new a({color:15854025,emissive:3351040,emissiveIntensity:.4,flatShading:!0}),S=new s(p,g);S.position.set(0,7,-5.1);const G=S.clone();return G.position.set(0,7,5.1),o.add(S,G),o.position.y=0,o}function zo(){const o=new E,t={wall1:16763196,wall3:16354268,trim:16777215,roof:11562043,detail:16726843},e=new s(new r(10,8,10),new a({color:t.wall1,flatShading:!0,roughness:.9}));e.position.y=4,o.add(e);const n=new r(10.1,.4,10.1),l=new s(n,new a({color:t.trim,flatShading:!0}));l.position.y=7.5,o.add(l);const i=new s(new r(12,1.4,12),new a({color:t.roof,flatShading:!0}));i.position.y=8.7,i.rotation.x=.05,o.add(i);const d=new s(new r(1.2,3,1.2),new a({color:t.detail,flatShading:!0}));d.position.set(2.5,10,-1.5),o.add(d);const c=new r(1.2,1.2,.3),w=new a({color:t.wall3,emissive:5579332,emissiveIntensity:.4,flatShading:!0}),f=new s(c,w);f.position.set(-2,6,-5.1);const y=f.clone();y.position.x=2;const u=f.clone();u.position.set(0,6,5.1),o.add(f,y,u);const m=new s(new r(4,2,.6),new a({color:t.trim,flatShading:!0}));return m.position.set(0,1,-5.3),o.add(m),o.position.y=0,o}function Io(){const o=new E,t=new a({color:12558706,roughness:.9,flatShading:!0}),e=new s(new r(9,6,9),t);e.position.y=3,o.add(e);const n=new a({color:8081712,roughness:.85,flatShading:!0}),l=new s(new r(9.2,.35,9.2),n);l.position.y=6.4,o.add(l);const i=new a({color:5981231,roughness:.95,flatShading:!0}),d=new s(new r(11,2,11),i);d.position.y=7.6,d.scale.y=1.5,d.rotation.x=.08,o.add(d);const c=new s(new r(1.2,2.2,.2),new a({color:5913124,flatShading:!0}));c.position.set(0,2,-4.6),o.add(c);const w=new s(new r(1,1,.2),new a({color:15853520,emissive:3351040,emissiveIntensity:.25,flatShading:!0}));return w.position.set(2,3.5,4.6),o.add(w),o.position.y=0,o}function ko(){const o=new E,t={wall:15790320,accent:2899536,roof:3426654,window:3447003},e=new s(new r(12,7,10),new a({color:t.wall,flatShading:!0,roughness:.3,metalness:.1}));e.position.y=3.5,o.add(e);const n=new s(new r(12.5,.6,10.5),new a({color:t.roof,flatShading:!0,roughness:.7}));n.position.y=7.3,o.add(n);const l=new s(new r(.5,7.2,10.2),new a({color:t.accent,flatShading:!0}));l.position.set(-3,3.5,0),o.add(l);const i=new r(2.5,4,.3),d=new a({color:t.window,emissive:1727626,emissiveIntensity:.3,flatShading:!0,transparent:!0,opacity:.7}),c=new s(i,d);c.position.set(1.5,4,-5.15);const w=c.clone();w.position.set(4.5,4,-5.15);const f=c.clone();f.position.set(0,4,5.15),o.add(c,w,f);const y=new s(new r(1.8,3,.2),new a({color:t.accent,flatShading:!0}));y.position.set(-1,2,-5.1),o.add(y);const u=new s(new r(3,.3,1.5),new a({color:t.accent,flatShading:!0}));return u.position.set(-1,.5,-6),o.add(u),o.position.y=0,o}function Go(){const o=new E,t={wall:15258784,wood:9132604,roof:10502144,door:6042391,stone:8421504},e=new s(new r(8,.8,8),new a({color:t.stone,flatShading:!0,roughness:1}));e.position.y=.4,o.add(e);const n=new s(new r(8,5,8),new a({color:t.wall,flatShading:!0,roughness:.9}));n.position.y=3.3,o.add(n);const l=new no(6.5,4,4),i=new a({color:t.roof,flatShading:!0,roughness:.95}),d=new s(l,i);d.position.y=7.8,d.rotation.y=Math.PI/4,o.add(d);const c=new a({color:t.wood,flatShading:!0}),w=new s(new r(8.2,.3,.3),c);w.position.set(0,2,-4.1);const f=w.clone();f.position.z=4.1;const y=w.clone();y.position.set(0,4.5,-4.1);const u=y.clone();u.position.z=4.1,o.add(w,f,y,u);const m=new s(new r(1.5,2.5,.2),new a({color:t.door,flatShading:!0}));m.position.set(0,2,-4.1),o.add(m);const x=new r(1,1,.2),v=new a({color:16770229,emissive:4465152,emissiveIntensity:.3,flatShading:!0}),p=new s(x,v);p.position.set(-2.5,3.5,-4.1);const g=p.clone();g.position.x=2.5;const S=p.clone();S.position.set(0,3.5,4.1),o.add(p,g,S);const G=new s(new r(.8,2.5,.8),new a({color:t.stone,flatShading:!0}));return G.position.set(2,8.5,-2),o.add(G),o.position.y=0,o}function Lo(){const o=new E,t={stone:7039851,darkStone:4868682,roof:9124410,window:16777184,wood:6636321},e=new s(new r(6,12,6),new a({color:t.stone,flatShading:!0,roughness:.95}));e.position.y=6,o.add(e);const n=new r(6.3,.4,6.3),l=new a({color:t.darkStone,flatShading:!0});[3,6,9,11.5].forEach(p=>{const g=new s(n,l);g.position.y=p,o.add(g)});const i=new no(4.5,3,8),d=new a({color:t.roof,flatShading:!0,roughness:.9}),c=new s(i,d);c.position.y=13.5,o.add(c);const w=new r(.8,1.2,.3),f=new a({color:t.window,emissive:5592320,emissiveIntensity:.4,flatShading:!0});[{x:0,y:4,z:-3.15},{x:3.15,y:7,z:0,rot:Math.PI/2},{x:0,y:10,z:3.15,rot:Math.PI},{x:-3.15,y:8.5,z:0,rot:-Math.PI/2}].forEach(p=>{const g=new s(w,f);g.position.set(p.x,p.y,p.z),p.rot&&(g.rotation.y=p.rot),o.add(g)});const u=new s(new r(1.8,3,.3),new a({color:t.wood,flatShading:!0}));u.position.set(0,1.5,-3.15),o.add(u);const m=new r(1,.8,1),x=new a({color:t.darkStone,flatShading:!0});return[{x:-2.5,z:-2.5},{x:2.5,z:-2.5},{x:-2.5,z:2.5},{x:2.5,z:2.5}].forEach(p=>{const g=new s(m,x);g.position.set(p.x,12.4,p.z),o.add(g)}),o.position.y=0,o}function Ho(){const o=new E,t={body:8947848,head:5592405,beak:16755200,leg:16746632,wing:7829367},e=new s(new r(.4,.3,.6),new a({color:t.body,flatShading:!0}));e.position.y=.3,o.add(e);const n=new s(new r(.25,.25,.3),new a({color:t.head,flatShading:!0}));n.position.set(0,.5,.3),o.add(n);const l=new s(new r(.08,.05,.15),new a({color:t.beak,flatShading:!0}));l.position.set(0,.5,.5),o.add(l);const i=new E,d=new s(new r(.1,.05,.5),new a({color:t.wing,flatShading:!0}));d.position.set(-.25,0,0),i.add(d),i.position.set(-.2,.35,0),o.add(i);const c=new E,w=new s(new r(.1,.05,.5),new a({color:t.wing,flatShading:!0}));w.position.set(.25,0,0),c.add(w),c.position.set(.2,.35,0),o.add(c);const f=new r(.05,.15,.05),y=new a({color:t.leg,flatShading:!0}),u=new s(f,y);u.position.set(-.1,.075,0);const m=new s(f,y);return m.position.set(.1,.075,0),o.add(u,m),o.userData.state="IDLE",o.userData.velocity=new A,o.userData.flightTime=0,o.userData.startPos=new A,o.userData.update=(x,v)=>{if(o.userData.state==="IDLE"){if(v){const p=new A;if(o.getWorldPosition(p),p.distanceTo(v)<15){o.userData.state="FLYING";const S=Math.random()*Math.PI*2,G=10+Math.random()*5;o.userData.velocity.set(Math.cos(S)*G,2+Math.random()*2,Math.sin(S)*G)}}}else if(o.userData.state==="FLYING"){o.userData.flightTime+=x,o.position.addScaledVector(o.userData.velocity,x);const g=Math.sin(o.userData.flightTime*20)*.5;if(i.rotation.z=g,c.rotation.z=-g,o.userData.velocity.lengthSq()>.1){const S=o.position.clone().add(o.userData.velocity);o.lookAt(S)}o.position.length()>150&&(o.userData.remove=!0)}},o}function Co(){const o=new E,t={stone:11575440,darkStone:9075306,roof:6636321,blade:16119260,bladeEdge:9139029,wood:9127187,window:16770229},e=new s(new N(4,4.5,3,8),new a({color:t.darkStone,flatShading:!0,roughness:.95}));e.position.y=1.5,o.add(e);const n=new s(new N(3.8,4,14,8),new a({color:t.stone,flatShading:!0,roughness:.9}));n.position.y=10,o.add(n);const l=new N(4.1,4.1,.4,8),i=new a({color:t.darkStone,flatShading:!0});[5,10,15].forEach(b=>{const h=new s(l,i);h.position.y=b,o.add(h)});const d=new s(new no(4.2,3,8),new a({color:t.roof,flatShading:!0,roughness:.9}));d.position.y=18.5,o.add(d);const c=new r(.8,1.2,.3),w=new a({color:t.window,emissive:4469504,emissiveIntensity:.3,flatShading:!0});[{y:6,angle:0},{y:9,angle:Math.PI/2},{y:12,angle:Math.PI},{y:14.5,angle:-Math.PI/2}].forEach(b=>{const h=new s(c,w),M=4;h.position.set(Math.sin(b.angle)*M,b.y,Math.cos(b.angle)*M),h.rotation.y=-b.angle,o.add(h)});const y=new s(new r(1.8,3,.3),new a({color:t.wood,flatShading:!0}));y.position.set(0,1.8,4.3),o.add(y);const u=new E,m=new s(new N(.4,.4,1.5,8),new a({color:t.wood,flatShading:!0}));m.rotation.z=Math.PI/2,u.add(m);const x=7,v=1.8,p=.15;for(let b=0;b<4;b++){const h=new E,M=new s(new r(v,x,p),new a({color:t.blade,flatShading:!0,roughness:.8}));M.position.y=x/2+.3,h.add(M);const z=new a({color:t.bladeEdge,flatShading:!0}),I=new s(new r(.25,x+.6,.2),z);I.position.set(0,x/2+.3,.05),h.add(I),[.3,x/2+.3,x+.3].forEach(F=>{const B=new s(new r(v+.1,.25,.2),z);B.position.set(0,F,.05),h.add(B)}),[-v/2,v/2].forEach(F=>{const B=new s(new r(.25,x+.6,.2),z);B.position.set(F,x/2+.3,.05),h.add(B)}),h.rotation.z=Math.PI/2*b,u.add(h)}u.position.set(0,13,4.2),u.rotation.x=-Math.PI/90,u.userData.rotate=!0,u.userData.rotationSpeed=.5,o.add(u);const g=new s(new N(2.5,2.5,.3,8),new a({color:t.wood,flatShading:!0}));g.position.y=16,o.add(g),o.position.y=0;const S=[],G=5+Math.floor(Math.random()*4);for(let b=0;b<G;b++){const h=Ho(),M=Math.random()*Math.PI*2,z=2+Math.random()*2,I=16+Math.random()*.5;h.position.set(Math.cos(M)*z,I,Math.sin(M)*z),h.rotation.y=Math.random()*Math.PI*2,o.add(h),S.push(h)}return o.userData.update=(b,h)=>{u.userData.rotate&&(u.rotation.z+=u.userData.rotationSpeed*b);for(let M=S.length-1;M>=0;M--){const z=S[M];z.userData.update&&z.userData.update(b,h),z.userData.remove&&(o.remove(z),S.splice(M,1),z.traverse(I=>{I.isMesh&&(I.geometry&&I.geometry.dispose(),I.material&&(Array.isArray(I.material)?I.material.forEach(F=>F.dispose()):I.material.dispose()))}))}},o}const Ao=document.getElementById("c"),O=new fo({canvas:Ao,antialias:!0});O.setPixelRatio(window.devicePixelRatio);O.setSize(window.innerWidth,window.innerHeight);const L=new uo;L.background=new ho(724759);const $=new po(60,window.innerWidth/window.innerHeight,.1,4e3);$.position.set(120,70,120);const C=new go($,O.domElement);C.enableDamping=!0;C.target.set(0,14,0);const D=new mo($,O.domElement);D.getObject().position.set(0,14,80);L.add(D.getObject());C.target.copy(D.getObject().position);L.add(new yo(10533375,1054752,.75));const io=new xo(16777215,.9);io.position.set(300,500,200);L.add(io);const P=120,$o=[{segments:64,distance:P*.7},{segments:32,distance:P*1.4},{segments:16,distance:P*2.6},{segments:8,distance:P*4.5}],Y=32,U=4,so=1e3,Oo=20,To=30,Wo=6,jo=document.getElementById("hud"),H=new Do;H.showPanel(0);H.dom.style.position="absolute";H.dom.style.top="12px";H.dom.style.left="calc(50% - 40px)";document.body.appendChild(H.dom);const V=tt()||"seed-example05",J=Po(K(V)),q=Ko(V),to=new Set,ro=[],j=new Map,Q=new Map,Vo=new bo,Fo=new A,oo=new A,ao=new A;new A;const k={forward:!1,backward:!1,left:!1,right:!1,jump:!1,run:!1};let _=!1,T=0,Z=0,eo=0;_o();Xo();co();wo();function Bo(o){return Q.has(o)||Q.set(o,new a({vertexColors:!0,flatShading:!1,roughness:.85,metalness:0})),Q.get(o)}function No(o,t){const e=`${o},${t}`;if(j.has(e))return j.get(e);const n=o*P+P/2,l=t*P+P/2,i=new So;for(const c of $o){const w=new Mo(P,P,c.segments,c.segments);w.rotateX(-Math.PI/2);const f=w.attributes.position,y=new Float32Array(f.count*3);for(let m=0;m<f.count;m++){const x=f.getX(m)+n,v=f.getZ(m)+l,p=W(x,v)*Y;f.setY(m,p);const g=Uo(p/Y);y[m*3+0]=g.r,y[m*3+1]=g.g,y[m*3+2]=g.b}w.setAttribute("color",new vo(y,3)),w.computeVertexNormals();const u=new s(w,Bo("terrain"));u.position.set(n,0,l),i.addLevel(u,c.distance)}L.add(i);const d={lod:i,ix:o,iz:t,houses:[],centerX:n,centerZ:l};return j.set(e,d),Zo(d),d}function Ro(o){!o||!o.lod||(o.lod.levels.forEach(({object:t})=>t.geometry&&t.geometry.dispose()),o.houses.forEach(t=>L.remove(t)),L.remove(o.lod))}function co(){const o=Math.floor($.position.x/P),t=Math.floor($.position.z/P),e=new Set;for(let n=-U;n<=U;n++)for(let l=-U;l<=U;l++){const i=o+l,d=t+n;e.add(`${i},${d}`),No(i,d)}for(const[n,l]of j.entries())e.has(n)||(Ro(l),j.delete(n))}function Ko(o){const t=K(o+"-plains"),e=[];for(let n=0;n<To;n++){const l=(t()-.5)*so,i=(t()-.5)*so,d=Oo+t()*12;e.push({x:l,z:i,radius:d,height:0})}return e}function W(o,t){const e=o/280,n=t/280;let l=.9*J(e,n)+.55*J(e*2.1,n*2.1)+.32*J(e*4.2,n*4.2);for(const i of q){const d=o-i.x,c=t-i.z,w=Math.sqrt(d*d+c*c);if(w<i.radius){const f=Math.max(0,1-w/i.radius);l=R.lerp(l,i.height,f*.9)}}return(l+1)/2}function Uo(o){const t=R.clamp(o,0,1);return t<.35?X([27,59,111],[46,109,181],t/.35):t<.55?X([45,106,63],[84,168,99],(t-.35)/.2):t<.8?X([115,104,87],[177,163,131],(t-.55)/.25):X([232,235,240],[255,255,255],(t-.8)/.2)}function X(o,t,e){const n=Math.max(0,Math.min(1,e));return{r:(o[0]+(t[0]-o[0])*n)/255,g:(o[1]+(t[1]-o[1])*n)/255,b:(o[2]+(t[2]-o[2])*n)/255}}function _o(){const o=document.getElementById("info");O.domElement.addEventListener("click",t=>{t.preventDefault(),D.lock()}),D.addEventListener("lock",()=>{o.style.opacity="0.75",C.enabled=!1}),D.addEventListener("unlock",()=>{o.style.opacity="1",C.enabled=!0,C.target.copy(D.getObject().position),C.update()})}function Xo(){const o=t=>e=>{switch(e.code){case"KeyW":case"ArrowUp":k.forward=t;break;case"KeyS":case"ArrowDown":k.backward=t;break;case"KeyA":case"ArrowLeft":k.left=t;break;case"KeyD":case"ArrowRight":k.right=t;break;case"Space":k.jump=t;break;case"ShiftLeft":case"ShiftRight":k.run=t;break;case"KeyT":t&&qo();break}};document.addEventListener("keydown",o(!0)),document.addEventListener("keyup",o(!1))}function Zo(o){const t=P/2;q.forEach((e,n)=>{if(to.has(n))return;const l=e.x>=o.centerX-t&&e.x<=o.centerX+t,i=e.z>=o.centerZ-t&&e.z<=o.centerZ+t;if(l&&i){const d=W(e.x,e.z)*Y,c=Yo(n);c.position.set(e.x,d,e.z),c.rotation.y=K(`${V}-house-${n}`)()*Math.PI*2,L.add(c),o.houses.push(c),to.add(n),c.userData.update&&ro.push(c)}})}function Yo(o){const t=K(`${V}-house-type-${o}`)();return t<.3?Co():t<.4?Eo():t<.5?zo():t<.6?Io():t<.75?ko():t<.9?Go():Lo()}function lo(o,t){const n=W(o,t),l=W(o+.001,t),i=W(o,t+.001),d=W(o+.001,t+.001),c=R.lerp(n,l,.5),w=R.lerp(i,d,.5);return R.lerp(c,w,.5)*Y}function qo(){let o=1/0,t=null;const e=D.getObject().position;if(q.forEach((n,l)=>{if(K(`${V}-house-type-${l}`)()<.3){const d=n.x-e.x,c=n.z-e.z,w=Math.sqrt(d*d+c*c);w<o&&(o=w,t=n)}}),t){const n=lo(t.x,t.z)+20;D.getObject().position.set(t.x,n,t.z+20),T=0,console.log("Teleported to windmill at",t)}else console.log("No windmills found in this seed!")}function Jo(o){if(!D.isLocked)return;const t=(k.right?1:0)-(k.left?1:0),e=(k.forward?1:0)-(k.backward?1:0),n=t!==0||e!==0,l=k.run?38:16,i=D.getObject().position;n&&(oo.copy(D.getDirection(Fo)).setY(0).normalize(),ao.crossVectors(oo,new A(0,1,0)).normalize(),i.addScaledVector(oo,e*l*o),i.addScaledVector(ao,t*l*o));const d=35,c=18;T-=d*o;const f=lo(i.x,i.z)+Wo;k.jump&&_&&(T=c,_=!1),i.y+T*o<=f?(i.y=f,T=0,_=!0):(i.y+=T*o,_=!1),Z=Math.max(0,i.y-f),Z>eo&&(eo=Z)}function wo(){const o=Vo.getDelta();H.begin(),requestAnimationFrame(wo),Jo(o),co();const t=D.getObject().position;ro.forEach(e=>{e.userData.update&&e.userData.update(o,t)}),D.isLocked||C.update(),O.render(L,$),H.end(),Qo()}function Qo(){const o=Math.round(H.getFPS?H.getFPS():0)||"--";jo.innerHTML=`
        <div>Seed: ${V}</div>
        <div>Chunks: ${j.size}</div>
        <div>Planícies: ${q.length}</div>
        <div>Casas colocadas: ${to.size}</div>
        <div>Altura do pulo: ${Z.toFixed(2)} m</div>
        <div>Altura máx.: ${eo.toFixed(2)} m</div>
        <div>FPS: ${o}</div>
      `}function ot(){const{innerWidth:o,innerHeight:t}=window;$.aspect=o/t,$.updateProjectionMatrix(),O.setSize(o,t)}window.addEventListener("resize",ot);function tt(){const o=window.location.hash.slice(1);return o&&(new URLSearchParams(o.replace(/&/g,"&")).get("seed")||o.split("seed=")[1])||null}
