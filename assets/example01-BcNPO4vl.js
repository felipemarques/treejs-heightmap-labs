import{W as X,P as N,S as _,C as J,F as Q,a as Z,b as $,O as ee,H as te,D as ne,M as O,c as oe,d as W,B as ae,e as se,f as ie,g as re,h as ce,T as de,i as he,L as F,j as le,V as S,k as x}from"./PointerLockControls-CkVu5uzN.js";const we=document.getElementById("scene-canvas"),h=new X({canvas:we,antialias:!0});h.setPixelRatio(Math.min(window.devicePixelRatio,1.5));h.setSize(window.innerWidth,window.innerHeight);h.shadowMap.enabled=!0;h.shadowMap.type=N;const l=new _;l.background=new J(329488);l.fog=new Q(329488,180,320);const g=new Z(60,window.innerWidth/window.innerHeight,.1,1e3);g.position.set(130,90,130);const m=new $(g,h.domElement);g.position.set(0,25,80);l.add(m.getObject());const p=new ee(g,h.domElement);p.enableDamping=!0;p.enabled=!0;const me=new te(10995711,659226,.8);l.add(me);const z=new ne(16777215,1.1);z.position.set(80,120,60);z.castShadow=!0;z.shadow.mapSize.set(2048,2048);l.add(z);const I="/examples/example01/heightmaps/sample-heightmap.png";async function pe(t){const e=await new Promise((a,r)=>{const s=new Image;s.src=t,s.crossOrigin="anonymous",s.onload=()=>a(s),s.onerror=r}),o=document.createElement("canvas");o.width=e.width,o.height=e.height;const n=o.getContext("2d");n.drawImage(e,0,0);const{data:c}=n.getImageData(0,0,e.width,e.height),i=new Float32Array(e.width*e.height);for(let a=0;a<i.length;a++)i[a]=c[a*4]/255;return{widths:e.width,heightsCount:e.height,data:i}}function ue(t,e,o,n,c,i,a,r=0){const s=i/2,f=x.clamp((n+s)/i,0,1),w=x.clamp((c+s)/i,0,1),d=f*(e-1),y=w*(o-1),b=Math.floor(d),M=Math.floor(y),A=Math.min(b+1,e-1),D=Math.min(M+1,o-1),H=d-b,G=y-M,K=M*e+b,R=M*e+A,V=D*e+b,U=D*e+A,Y=x.lerp(t[K],t[R],H),q=x.lerp(t[V],t[U],H);return x.lerp(Y,q,G)*a+r}async function fe(){const{widths:t,heightsCount:e,data:o}=await pe(I),n=260,c=42,i=-6,a=new ce(n,n,t-1,e-1);a.rotateX(-Math.PI/2);const r=a.attributes.position;for(let d=0;d<r.count;d++){const y=d%t,b=Math.floor(d/t),M=o[b*t+y]*c+i;r.setY(d,M)}r.needsUpdate=!0,a.computeVertexNormals();const s=new de().load(I);s.wrapS=s.wrapT=he,s.minFilter=F,s.magFilter=F;const f=new W({color:9085368,map:s,metalness:.15,roughness:.85}),w=new O(a,f);return w.receiveShadow=!0,w.castShadow=!0,l.add(w),{terrain:w,heights:o,hmW:t,hmH:e,size:n,heightScale:c,heightBias:i}}const T=new O(new oe(460,80).rotateX(-Math.PI/2),new W({color:329488,roughness:1}));T.receiveShadow=!0;l.add(T);function ge(){const o=new ae,n=new Float32Array(1500*3);for(let a=0;a<1500;a++){const r=Math.acos(2*Math.random()-1),s=2*Math.PI*Math.random(),f=800,w=f*Math.sin(r)*Math.cos(s),d=f*Math.cos(r),y=f*Math.sin(r)*Math.sin(s);n[a*3]=w,n[a*3+1]=d,n[a*3+2]=y}o.setAttribute("position",new se(n,3));const c=new ie({color:16777215,size:1.6,sizeAttenuation:!0,transparent:!0,opacity:.9}),i=new re(o,c);l.add(i)}ge();function ye(){const t=document.getElementById("info"),e=h.domElement,o=n=>{n.preventDefault(),m.lock()};e.addEventListener("click",o),m.addEventListener("lock",()=>{t.style.opacity="0.7",p.enabled=!1}),m.addEventListener("unlock",()=>{t.style.opacity="1",p.enabled=!0,p.target.copy(m.getObject().position),p.update()})}const u={forward:!1,backward:!1,left:!1,right:!1};function be(){const t=e=>o=>{switch(o.code){case"KeyW":case"ArrowUp":u.forward=e;break;case"KeyS":case"ArrowDown":u.backward=e;break;case"KeyA":case"ArrowLeft":u.left=e;break;case"KeyD":case"ArrowRight":u.right=e;break;case"Space":e&&C&&(k.y=E.jumpSpeed,C=!1);break}};document.addEventListener("keydown",t(!0)),document.addEventListener("keyup",t(!1))}function Me(){const{innerWidth:t,innerHeight:e}=window;g.aspect=t/e,g.updateProjectionMatrix(),h.setSize(t,e)}window.addEventListener("resize",Me);const Se=new le,k=new S,v=new S,L=new S,j=new S,xe=new S;let P=null,C=!1;const E={moveSpeed:40,jumpSpeed:18,gravity:35};fe().then(({heights:t,hmW:e,hmH:o,size:n,heightScale:c,heightBias:i})=>{P=(a,r)=>ue(t,e,o,a,r,n,c,i)});ye();be();function ke(t){if(v.set((u.right?1:0)-(u.left?1:0),0,(u.forward?1:0)-(u.backward?1:0)).normalize(),v.lengthSq()>0){const o=E.moveSpeed*t;L.copy(m.getDirection(xe)).setY(0).normalize(),j.crossVectors(L,new S(0,1,0)).normalize();const n=m.getObject().position;n.addScaledVector(L,v.z*o),n.addScaledVector(j,v.x*o)}const e=m.getObject().position;if(k.y-=E.gravity*t,P){const n=P(e.x,e.z)+6.5;e.y+k.y*t<=n?(e.y=n,k.y=0,C=!0):(e.y+=k.y*t,C=!1)}}function B(){const t=Se.getDelta();ke(t),p.enabled&&p.update(),h.render(l,g),requestAnimationFrame(B)}B();
