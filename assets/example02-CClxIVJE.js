import{W as U,S as V,C as _,a as q,O as T,b as Y,A as J,D as X,h as Q,d as Z,M as ee,V as E,j as te,k as y,e as ne}from"./PointerLockControls-CkVu5uzN.js";import{S as oe,c as se}from"./simplex-noise-BLd_4JM9.js";const re=document.getElementById("c"),x=new U({canvas:re,antialias:!0});x.setPixelRatio(window.devicePixelRatio);x.setSize(window.innerWidth,window.innerHeight);const M=new V;M.background=new _(987414);const h=new q(60,window.innerWidth/window.innerHeight,.1,1e3);h.position.set(80,45,80);const w=256,F=256,p=200,G=40,u=new T(h,x.domElement);u.enableDamping=!0;u.target.set(0,10,0);const d=new Y(h,x.domElement);d.getObject().position.set(0,G+10,40);h.position.copy(d.getObject().position);M.add(d.getObject());u.target.copy(d.getObject().position);M.add(new J(16777215,.35));const B=new X(16777215,.9);B.position.set(80,120,40);M.add(B);const{data:C}=he(w,F),W=new Q(p,p,w-1,F-1);W.rotateX(-Math.PI/2);be(W,C,G);const ae=new Z({vertexColors:!0,flatShading:!1,roughness:.9,metalness:0}),I=new ee(W,ae);I.receiveShadow=!1;M.add(I);window.addEventListener("resize",pe);const s=new oe;s.showPanel(0);s.dom.style.position="absolute";s.dom.style.top="12px";s.dom.style.left="calc(50% - 40px)";document.body.appendChild(s.dom);const ie=document.getElementById("perf"),ce=x.getContext(),de=Se(ce),le=new te,l={forward:!1,backward:!1,left:!1,right:!1,jump:!1},L=new E,A=new E,O=new E,R=new E,fe=new E,me=new E(0,1,0);let j=!1;const z={moveSpeed:35,jumpSpeed:12,gravity:35,eyeHeight:6};xe();ge();N();function N(){const e=le.getDelta();s.begin(),requestAnimationFrame(N),ye(e),u.enabled&&u.update(),x.render(M,h),s.end(),ue()}function pe(){const{innerWidth:e,innerHeight:t}=window;h.aspect=e/t,h.updateProjectionMatrix(),x.setSize(e,t)}function ue(){const e=x.info,t=Math.round(s.getFPS?s.getFPS():1e3/s.dom.children[0].innerText||0),o=Math.round(s.dom.firstChild&&s.dom.firstChild.textContent?parseFloat(s.dom.firstChild.textContent):s.dom?s.dom.textContent:0),n=performance.memory?`${(performance.memory.usedJSHeapSize/1048576).toFixed(1)} / ${(performance.memory.jsHeapSizeLimit/1048576).toFixed(0)} MB`:"n/d";ie.innerHTML=`
        <div>FPS: ${t||"--"}</div>
        <div>ms: ${Number.isFinite(o)?o:"--"}</div>
        <div>Draws: ${e.render.calls} | Tris: ${e.render.triangles}</div>
        <div>Geom/Mats: ${e.memory.geometries} / ${e.memory.textures}</div>
        <div>GPU: ${de}</div>
        <div>Mem: ${n}</div>
      `}function xe(){const e=document.getElementById("info");x.domElement.addEventListener("click",t=>{t.preventDefault(),d.lock()}),d.addEventListener("lock",()=>{e.style.opacity="0.75",u.enabled=!1}),d.addEventListener("unlock",()=>{e.style.opacity="1",u.enabled=!0,u.target.copy(d.getObject().position),u.update()})}function ge(){const e=t=>o=>{switch(o.code){case"KeyW":case"ArrowUp":l.forward=t;break;case"KeyS":case"ArrowDown":l.backward=t;break;case"KeyA":case"ArrowLeft":l.left=t;break;case"KeyD":case"ArrowRight":l.right=t;break;case"Space":l.jump=t;break}};document.addEventListener("keydown",e(!0)),document.addEventListener("keyup",e(!1))}function we(e,t){const o=p/2,n=y.clamp((e+o)/p,0,1),g=y.clamp((t+o)/p,0,1),c=n*(w-1),r=g*(F-1),f=Math.floor(c),a=Math.floor(r),m=Math.min(f+1,w-1),b=Math.min(a+1,F-1),i=c-f,v=r-a,P=a*w+f,k=a*w+m,S=b*w+f,H=b*w+m,D=y.lerp(C[P],C[k],i),K=y.lerp(C[S],C[H],i);return y.lerp(D,K,v)*G}function ye(e){if(!d.isLocked)return;A.set((l.right?1:0)-(l.left?1:0),0,(l.forward?1:0)-(l.backward?1:0)).normalize();const t=d.getObject().position;A.lengthSq()>0&&(O.copy(d.getDirection(fe)).setY(0).normalize(),R.crossVectors(O,me).normalize(),t.addScaledVector(O,A.z*z.moveSpeed*e),t.addScaledVector(R,A.x*z.moveSpeed*e)),L.y-=z.gravity*e;const n=we(t.x,t.z)+z.eyeHeight;l.jump&&j&&(L.y=z.jumpSpeed,j=!1),t.y+L.y*e<=n?(t.y=n,L.y=0,j=!0):(t.y+=L.y*e,j=!1),t.x=y.clamp(t.x,-p/2+1,p/2-1),t.z=y.clamp(t.z,-p/2+1,p/2-1)}function he(e,t){const o=se(),n=new Float32Array(e*t),g=4,c=2,r=.5,f=.02;let a=1/0,m=-1/0;for(let i=0;i<t;i++)for(let v=0;v<e;v++){let P=1,k=f,S=0;for(let D=0;D<g;D++)S+=P*o(v*k,i*k),P*=r,k*=c;const H=i*e+v;n[H]=S,a=Math.min(a,S),m=Math.max(m,S)}const b=m-a||1;for(let i=0;i<n.length;i++)n[i]=(n[i]-a)/b;return{data:n,min:a,max:m}}function be(e,t,o){const n=e.attributes.position,g=n.count,c=new Float32Array(g*3);for(let r=0;r<g;r++){const f=t[r];n.setY(r,f*o);const{r:a,g:m,b}=ve(f);c[r*3+0]=a,c[r*3+1]=m,c[r*3+2]=b}e.setAttribute("color",new ne(c,3)),n.needsUpdate=!0,e.computeVertexNormals()}function ve(e){return e<.35?$([31,79,131],[43,115,182],e/.35):e<.55?$([44,110,73],[79,162,91],(e-.35)/.2):e<.75?$([115,104,87],[179,156,122],(e-.55)/.2):$([229,231,235],[255,255,255],(e-.75)/.25)}function $(e,t,o){const n=Math.max(0,Math.min(1,o)),g=e[0]+(t[0]-e[0])*n,c=e[1]+(t[1]-e[1])*n,r=e[2]+(t[2]-e[2])*n;return{r:g/255,g:c/255,b:r/255}}function Se(e){const t=e.getExtension("WEBGL_debug_renderer_info");if(t){const o=e.getParameter(t.UNMASKED_VENDOR_WEBGL),n=e.getParameter(t.UNMASKED_RENDERER_WEBGL);return`${o} | ${n}`}return"n/d"}
