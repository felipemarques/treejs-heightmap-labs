import{W as X,P as N,S as _,C as J,F as Q,a as Z,b as $,O as ee,H as te,D as ne,M as T,c as oe,d as B,B as ae,e as se,f as ie,g as re,h as ce,T as de,i as he,L as F,j as le,V as S,k as b}from"./PointerLockControls-CkVu5uzN.js";const we=document.getElementById("scene-canvas"),l=new X({canvas:we,antialias:!0});l.setPixelRatio(Math.min(window.devicePixelRatio,1.5));l.setSize(window.innerWidth,window.innerHeight);l.shadowMap.enabled=!0;l.shadowMap.type=N;const u=new _;u.background=new J(329488);u.fog=new Q(329488,180,320);const h=new Z(60,window.innerWidth/window.innerHeight,.1,1e3);h.position.set(130,90,130);const v=new $(h,l.domElement);h.position.set(0,25,80);const m=new ee(h,l.domElement);m.enableDamping=!0;m.enabled=!0;const me=new te(10995711,659226,.8);u.add(me);const z=new ne(16777215,1.1);z.position.set(80,120,60);z.castShadow=!0;z.shadow.mapSize.set(2048,2048);u.add(z);const I="/examples/example01/heightmaps/sample-heightmap.png";async function pe(t){const e=await new Promise((a,r)=>{const s=new Image;s.src=t,s.crossOrigin="anonymous",s.onload=()=>a(s),s.onerror=r}),o=document.createElement("canvas");o.width=e.width,o.height=e.height;const n=o.getContext("2d");n.drawImage(e,0,0);const{data:c}=n.getImageData(0,0,e.width,e.height),i=new Float32Array(e.width*e.height);for(let a=0;a<i.length;a++)i[a]=c[a*4]/255;return{widths:e.width,heightsCount:e.height,data:i}}function ue(t,e,o,n,c,i,a,r=0){const s=i/2,f=b.clamp((n+s)/i,0,1),w=b.clamp((c+s)/i,0,1),d=f*(e-1),g=w*(o-1),y=Math.floor(d),M=Math.floor(g),A=Math.min(y+1,e-1),D=Math.min(M+1,o-1),H=d-y,R=g-M,V=M*e+y,j=M*e+A,O=D*e+y,U=D*e+A,Y=b.lerp(t[V],t[j],H),q=b.lerp(t[O],t[U],H);return b.lerp(Y,q,R)*a+r}async function fe(){const{widths:t,heightsCount:e,data:o}=await pe(I),n=260,c=42,i=-6,a=new ce(n,n,t-1,e-1);a.rotateX(-Math.PI/2);const r=a.attributes.position;for(let d=0;d<r.count;d++){const g=d%t,y=Math.floor(d/t),M=o[y*t+g]*c+i;r.setY(d,M)}r.needsUpdate=!0,a.computeVertexNormals();const s=new de().load(I);s.wrapS=s.wrapT=he,s.minFilter=F,s.magFilter=F;const f=new B({color:9085368,map:s,metalness:.15,roughness:.85}),w=new T(a,f);return w.receiveShadow=!0,w.castShadow=!0,u.add(w),{terrain:w,heights:o,hmW:t,hmH:e,size:n,heightScale:c,heightBias:i}}const G=new T(new oe(460,80).rotateX(-Math.PI/2),new B({color:329488,roughness:1}));G.receiveShadow=!0;u.add(G);function ge(){const o=new ae,n=new Float32Array(1500*3);for(let a=0;a<1500;a++){const r=Math.acos(2*Math.random()-1),s=2*Math.PI*Math.random(),f=800,w=f*Math.sin(r)*Math.cos(s),d=f*Math.cos(r),g=f*Math.sin(r)*Math.sin(s);n[a*3]=w,n[a*3+1]=d,n[a*3+2]=g}o.setAttribute("position",new se(n,3));const c=new ie({color:16777215,size:1.6,sizeAttenuation:!0,transparent:!0,opacity:.9}),i=new re(o,c);u.add(i)}ge();function ye(){const t=document.getElementById("info"),e=l.domElement,o=n=>{n.preventDefault(),v.lock()};e.addEventListener("click",o),v.addEventListener("lock",()=>{t.style.opacity="0.7",m.enabled=!1}),v.addEventListener("unlock",()=>{t.style.opacity="1",m.enabled=!0,m.target.copy(h.position),m.update()})}const p={forward:!1,backward:!1,left:!1,right:!1};function Me(){const t=e=>o=>{switch(o.code){case"KeyW":case"ArrowUp":p.forward=e;break;case"KeyS":case"ArrowDown":p.backward=e;break;case"KeyA":case"ArrowLeft":p.left=e;break;case"KeyD":case"ArrowRight":p.right=e;break;case"Space":e&&C&&(x.y=E.jumpSpeed,C=!1);break}};document.addEventListener("keydown",t(!0)),document.addEventListener("keyup",t(!1))}function Se(){const{innerWidth:t,innerHeight:e}=window;h.aspect=t/e,h.updateProjectionMatrix(),l.setSize(t,e)}window.addEventListener("resize",Se);const be=new le,x=new S,k=new S,L=new S,W=new S,xe=new S;let P=null,C=!1;const E={moveSpeed:40,jumpSpeed:18,gravity:35};fe().then(({heights:t,hmW:e,hmH:o,size:n,heightScale:c,heightBias:i})=>{P=(a,r)=>ue(t,e,o,a,r,n,c,i)});ye();Me();function ke(t){if(k.set((p.right?1:0)-(p.left?1:0),0,(p.forward?1:0)-(p.backward?1:0)).normalize(),k.lengthSq()>0){const o=E.moveSpeed*t;L.copy(v.getDirection(xe)).setY(0).normalize(),W.crossVectors(L,new S(0,1,0)).normalize();const n=h.position;n.addScaledVector(L,k.z*o),n.addScaledVector(W,k.x*o)}const e=h.position;if(x.y-=E.gravity*t,P){const n=P(e.x,e.z)+6.5;e.y+x.y*t<=n?(e.y=n,x.y=0,C=!0):(e.y+=x.y*t,C=!1)}}function K(){const t=be.getDelta();ke(t),m.enabled&&m.update(),l.render(u,h),requestAnimationFrame(K)}K();
